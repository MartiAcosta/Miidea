function conferenceTimeLapse(){conferenceTimeSecs+=1}function resetConferenceTimeSecs(n,t){n==7&&$o.saveRecord.conference(4,$o.core.conferenceVars.ENDED,t,conferenceTimeSecs);conferenceTimeSecs=0}var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Oct8ne;(function(n){var t;(function(t){var p=2e4,e="oct8ne-call",b=function(){function w(r,u,f,e){var o=this,h;e===void 0&&(e=l.None);this.settings=r;this.sessionStorageManager=f;this.logLevel=e;this.callingTimeout=0;this.receivingCallTimeout=0;this.autoAnswerCalls=!1;this.status="Idle";this.isCalling=function(){return o.status==="Calling"};this.isIdle=function(){return o.status==="Idle"};this.isConnecting=function(){return o.status==="Connecting"};this.isReceivingCall=function(){return o.status==="ReceivingCall"};this.isInCall=function(){return o.status==="InCall"};this.localEndpoint=new i(!1,!1,!1,!1,!1);this.remoteEndpoint=new i(!1,!1,!1,!1,!1);this.onStatusChanged=new n.Event;this.onLocalMuteChanged=new n.Event;this.onRemoteMuteChanged=new n.Event;this.onIncomingCall=new n.Event;this.onCalling=new n.Event;this.onOutgoingCallNotAnswered=new n.Event;this.onIncomingCallAccepted=new n.Event;this.onCallEnded=new n.Event;this.onCallStarted=new n.Event;this.onLocalMediaError=new n.Event;this.onLocalMediaAvailabilityChanged=new n.Event;this.onRemoteMediaAvailabilityChanged=new n.Event;this.onScreenSharingCapabilitiesDetected=new n.Event;this.onScreenSharingStatusChanged=new n.Event;this.onRemoteScreenSharingStatusChanged=new n.Event;this.onRecordingStarted=new n.Event;this.onRecordingStopped=new n.Event;this.onRecordingSupportDetected=new n.Event;this.isEnding=!1;this.wasVideoMutedBeforeSharingScreen=!1;this.role=r.role;r.conferenceProviderName=r.conferenceProviderName.toLowerCase();r.recordingMode=r.recordingMode||"none";this.platform=u;this.platform.onIncomingCallReceived.on(function(n){return o.handleIncomingCallMessage(n)});this.platform.onCallAcceptedReceived.on(function(n){return o.handleCallAcceptedMessage(n)});this.platform.onEndCallReceived.on(function(n){return o.handleEndCallMessage(n)});this.platform.onPeerDisconnected.on(function(){return o.handlePeerDisconnectedMessage()});this.platform.onSelfDisconnected.on(function(){return o.handleSelfDisconnectedMessage()});this.platform.onRemoteMuteChanged.on(function(n){return o.handleRemoteMuteChangedMessage(n)});this.platform.onCallMeToContinueConferenceReceived.on(function(n){var t=new s(n.sessionId,n.properties.type,n.properties.remote,n.properties.local,!1);o.startDirectCall(t)});h=!!(this.logLevel&l.Provider);this.conferenceProvider=t.Providers.ProviderFactory.createProvider(this.settings.conferenceProviderName,this.platform,h,this.settings,this.sessionStorageManager);setTimeout(function(){o.conferenceProvider.getProviderCapabilities().supportsRecording?(o.log("Allow manual recording: true"),o.onRecordingSupportDetected.trigger(!0)):(o.log("Allow manual recording: false"),o.settings.recordingMode="none",o.onRecordingSupportDetected.trigger(!1))},1);this.conferenceProvider.onConnected.on(function(){return o.handleProviderConferenceConnectedEvent()});this.conferenceProvider.onDisconnected.on(function(n){return o.handleProviderConferenceDisconnectedEvent(n)});this.conferenceProvider.onError.on(function(n){return o.handleProviderConferenceErrorEvent(n)});this.conferenceProvider.onScreenSharingCapabilitiesDetected.on(function(n){return o.handleScreenSharingDetectionFinished(n)});this.conferenceProvider.onLocalScreenSharingStatusChanged.on(function(n){return o.handleLocalScreenSharingStatusChanged(n)});this.conferenceProvider.onRemoteScreenSharingStatusChanged.on(function(n){return o.handleRemoteScreenSharingStatusChanged(n)});this.conferenceProvider.onLocalMediaAvailabilityChanged.on(function(n){return o.handleLocalMediaAvailabilityChanged(n)});this.conferenceProvider.onRemoteMediaAvailabilityChanged.on(function(n){return o.handleRemoteMediaAvailabilityChanged(n)});this.conferenceProvider.onLocalMediaError.on(function(n){return o.handleLocalMediaError(n)});this.conferenceProvider.onRecordingStarted.on(function(){return o.onRecordingStarted.trigger()});this.conferenceProvider.onRecordingStopped.on(function(){return o.onRecordingStopped.trigger()})}return w.prototype.startCall=function(n,t){if(this.status==="Idle"){switch(n){case"video-call":this.localEndpoint=new i(!0,!1,!0,!1,!1);this.remoteEndpoint=new i(!0,!1,!1,!0,!1);break;case"audio-call":this.localEndpoint=new i(!0,!1,!1,!0,!1);this.remoteEndpoint=new i(!0,!1,!1,!0,!1);break;case"screen-only-call":this.localEndpoint=new i(!1,!1,!1,!1,!0);this.remoteEndpoint=new i(!1,!1,!1,!1,!1)}this.iAmTheCaller=!0;var r=new f(n,this.localEndpoint,this.remoteEndpoint);this.startConference(t,r,!1)}},w.prototype.startVideo=function(){this.status!=="InCall"&&this.localEndpoint.isVideoAvailable||this.conferenceProvider.startVideoAsync()},w.prototype.stopVideo=function(){(this.status==="InCall"||this.localEndpoint.isVideoAvailable)&&this.conferenceProvider.stopVideoAsync()},w.prototype.startRecording=function(){this.conferenceProvider.getProviderCapabilities().supportsRecording&&this.settings.recordingMode==="manual"&&this.conferenceProvider.startRecordingAsync()},w.prototype.stopRecording=function(){this.conferenceProvider.getProviderCapabilities().supportsRecording&&this.settings.recordingMode==="manual"&&this.conferenceProvider.stopRecordingAsync()},w.prototype.resumeCallIfNeeded=function(){var n,r;this.log("Entering resumeCallIfNeeded");n=this.sessionStorageManager.get(e);n?n.iAmTheCaller?(this.log("I'm the caller, so I have to start a new call"),this.sessionStorageManager.remove(e),this.iAmTheCaller=!0,this.startDirectCall(n)):(this.log("I'm not the caller, so I have to tell my peer to start a new call"),this.log("Sending callme message to continue the conference "+n.id),this.log("        with Local: "+i.toString(n.local)),this.log("        and Remote: "+i.toString(n.remote)),r=new v(n.id,n),this.lastSessionId=n.id,this.platform.send(t.Message.CallMeToContinueConference,n.id,r)):this.log("No previous call from my side")},w.prototype.startDirectCall=function(n){var i=+n.started,r=+new Date,u=(r-i)/6e4,t;if(u>120){this.log("Call not resumed: conference too old");this.removeCallInformation();return}this.localEndpoint=n.local;this.remoteEndpoint=n.remote;(this.localEndpoint.isSharingScreen||this.remoteEndpoint.isSharingScreen)&&(this.localEndpoint.isSharingScreen=this.remoteEndpoint.isSharingScreen=!1,this.localEndpoint.isVideoAvailable=this.remoteEndpoint.isVideoAvailable=!1);this.log("Resuming call "+n.id);this.log("**** Resuming: Local audio muted: "+this.localEndpoint.isAudioMuted);t=new f(n.type,n.local,n.remote);this.startConference(n.id,t,!0)},w.prototype.startConference=function(n,i,u){return __awaiter(this,void 0,void 0,function(){var f,e,s=this;return __generator(this,function(l){switch(l.label){case 0:return[4,this.conferenceProvider.initializeCallAsync(n,i.type,i.local)];case 1:return(f=l.sent(),f instanceof t.ProviderError)?(f=f,f.errorType===t.ProviderErrorType.InitializationError?this.onCallEnded.trigger(new r(n,t.EndCallCause.InvalidProvider)):this.onCallEnded.trigger(new r(n,t.EndCallCause.LocalDeviceNotAllowed)),[2]):(f=f,this.currentProviderInformation=f,this.onCalling.trigger(new c(n,i,u,f)),this.changeStatusTo("Calling"),this.currentCallType=i.type,this.currentSessionId=n,this.isCallResuming=u,e=new h(this.currentSessionId,i,u,f),this.log("Send "+f.providerName+" "+this.currentCallType+" call with mute Local("+i.local.isAudioMuted+","+i.local.isVideoMuted+"), Remote("+i.remote.isAudioMuted+","+i.remote.isVideoMuted+")"),this.platform.send(t.Message.RequestConference,this.currentSessionId,e),this.callingTimeout=setTimeout(function(){s.setAsIdle();s.onOutgoingCallNotAnswered.trigger(new o(n))},p),[2])}})})},w.prototype.startScreenSharing=function(){this.status==="InCall"&&this.conferenceProvider.startScreenSharingAsync()},w.prototype.stopScreenSharing=function(){this.status==="InCall"&&this.conferenceProvider.stopScreenSharingAsync()},w.prototype.handleIncomingCallMessage=function(n){var u=this;if(this.settings.conferenceProviderName!==n.providerInformation.providerName){this.log("Incoming "+n.providerInformation.providerName+" call "+n.sessionId+" cancelled due to invalid provider");this.platform.send(t.Message.EndCall,n.sessionId,new r(n.sessionId,t.EndCallCause.InvalidProvider));return}if(this.iAmTheCaller=!1,this.status!=="Idle"&&!n.resume){this.log("Incoming "+n.providerInformation.providerName+" call "+n.sessionId+" ended (status "+this.status+")");this.platform.send(t.Message.EndCall,n.sessionId,new r(n.sessionId,t.EndCallCause.PeerBusy));return}if(n.resume&&n.sessionId!==this.lastSessionId){this.log("Incoming "+n.providerInformation.providerName+" resume "+n.sessionId+" ended (lastConference was "+this.lastSessionId+")");this.platform.send(t.Message.EndCall,n.sessionId,new r(n.sessionId,t.EndCallCause.PeerBusy));return}if(this.currentProviderInformation=n.providerInformation,this.localEndpoint=n.properties.remote,this.remoteEndpoint=n.properties.local,this.currentCallType=n.properties.type,this.log("Incoming "+n.providerInformation.providerName+" "+this.currentCallType+" call, Local: "+i.toString(this.localEndpoint)+", Remote: "+i.toString(this.remoteEndpoint)),this.isCallResuming=n.resume,this.currentSessionId=n.sessionId,this.changeStatusTo("ReceivingCall"),this.autoAnswerCalls||n.resume){this.acceptCall();return}this.receivingCallTimeout=setTimeout(function(){u.endCall(!0)},p);this.onIncomingCall.trigger(n)},w.prototype.acceptCall=function(){this.isReceivingCall()&&(this.log("Accept call started"),this.clearTimeouts(),this.platform.send(t.Message.CallAccepted,this.currentSessionId,new o(this.currentSessionId)),this.startProviderConference(!1,this.currentCallType,this.currentProviderInformation),this.onIncomingCallAccepted.trigger(new o(this.currentSessionId)))},w.prototype.endCall=function(n,i){var u,f;(n===void 0&&(n=!1),i===void 0&&(i=null),this.isIdle()||this.isEnding)||(this.isEnding=!0,this.log("Ending call started"),this.isConnecting()?(u=i||t.EndCallCause.Cancelled,this.removeCallInformation()):this.isCalling()?u=t.EndCallCause.Cancelled:this.isReceivingCall()?u=n?t.EndCallCause.Ended:t.EndCallCause.Cancelled:this.isInCall()?(u=t.EndCallCause.Ended,this.removeCallInformation()):u=t.EndCallCause.GeneralError,f=new r(this.currentSessionId,u),this.platform.send(t.Message.EndCall,this.currentSessionId,f),this.conferenceProvider.end(u),this.onCallEnded.trigger(f),this.setAsIdle(),this.isEnding=!1)},w.prototype.handleCallAcceptedMessage=function(n){(this.currentSessionId===n.sessionId||this.lastSessionId===n.sessionId)&&(this.log("Call accepted by remote peer. Starting conference..."),this.startProviderConference(!0,this.currentCallType,this.currentProviderInformation))},w.prototype.handleEndCallMessage=function(n){this.currentSessionId===n.sessionId&&(this.onCallEnded.trigger(n),this.conferenceProvider.end(n.cause),n.cause===t.EndCallCause.Ended&&this.removeCallInformation(),this.setAsIdle())},w.prototype.startProviderConference=function(n,i,r){this.clearTimeouts();this.changeStatusTo("Connecting");var u=new t.Providers.ConferenceStartOptions(this.currentSessionId,new f(i,this.localEndpoint,this.remoteEndpoint));this.conferenceProvider.startAsync(n,u,r)},w.prototype.clearTimeouts=function(){clearTimeout(this.callingTimeout);clearTimeout(this.receivingCallTimeout)},w.prototype.setAsIdle=function(){function t(n){n!=null&&(n.isVideoMuted=!1,n.isAudioMuted=!1,n.isAudioAvailable=!1,n.isVideoAvailable=!1)}var n=this;this.status!=="Idle"&&(t(this.localEndpoint),t(this.remoteEndpoint),this.clearTimeouts(),this.currentSessionId="",this.changeStatusTo("Idle"),this.isCallResuming=!1,this.onRecordingStopped.trigger(),setTimeout(function(){n.isIdle()&&n.removeCallInformation()},6e4))},w.prototype.muteAudioToggle=function(){if(!this.isCalling()){var n=!this.localEndpoint.isAudioMuted;this.localEndpoint.isAudioMuted=n;this.log("Audio muted: "+n);this.saveCallInformation();this.onLocalMuteChanged.trigger(new u(this.currentSessionId,"audio",n));this.conferenceProvider.muteAudio(n);this.platform.send(t.Message.MuteChanged,this.currentSessionId,new u(this.currentSessionId,"audio",n))}},w.prototype.muteVideoToggle=function(){if(!this.isCalling()){var n=!this.localEndpoint.isVideoMuted;this.localEndpoint.isVideoMuted=n;this.log("Video muted: "+n);this.saveCallInformation();this.conferenceProvider.muteVideo(n);this.onLocalMuteChanged.trigger(new u(this.currentSessionId,"video",n));this.platform.send(t.Message.MuteChanged,this.currentSessionId,new u(this.currentSessionId,"video",n))}},w.prototype.toggleCam=function(){this.isCalling()||this.conferenceProvider.toggleCamera()},w.prototype.handleRemoteMuteChangedMessage=function(n){n&&this.currentSessionId===n.sessionId&&(this.log("Remote mute received "+n.type+": "+n.muted),n.type==="audio"?(this.remoteEndpoint.isAudioMuted=n.muted,this.onRemoteMuteChanged.trigger(new u(this.currentSessionId,"audio",this.remoteEndpoint.isAudioMuted))):n.type==="video"&&(this.remoteEndpoint.isVideoMuted=n.muted,this.onRemoteMuteChanged.trigger(new u(this.currentSessionId,"video",this.remoteEndpoint.isVideoMuted))),this.saveCallInformation())},w.prototype.handleProviderConferenceConnectedEvent=function(){this.clearTimeouts();this.log("Connected "+this.currentCallType+" with Mute: Local("+this.localEndpoint.isAudioMuted+","+this.localEndpoint.isVideoMuted+"), Remote("+this.remoteEndpoint.isAudioMuted+","+this.remoteEndpoint.isVideoMuted+")");this.onCallStarted.trigger(new a(this.currentSessionId,new f(this.currentCallType,this.localEndpoint,this.remoteEndpoint),this.isCallResuming,this.currentProviderInformation));this.onLocalMuteChanged.trigger(new u(this.currentSessionId,"audio",this.localEndpoint.isAudioMuted));this.onLocalMuteChanged.trigger(new u(this.currentSessionId,"video",this.localEndpoint.isVideoMuted));this.remoteEndpoint.isAudioMuted&&this.onRemoteMuteChanged.trigger(new u(this.currentSessionId,"audio",this.remoteEndpoint.isAudioMuted));this.remoteEndpoint.isVideoMuted&&this.onRemoteMuteChanged.trigger(new u(this.currentSessionId,"video",this.remoteEndpoint.isVideoMuted));this.lastSessionId=this.currentSessionId;this.saveCallInformation();this.changeStatusTo("InCall")},w.prototype.handleProviderConferenceDisconnectedEvent=function(n){this.log("Disconnected. Reason: "+t.EndCallCausesUtils.toString(n));this.endCall(!1,t.EndCallCause.PeerDisconnected)},w.prototype.handleScreenSharingDetectionFinished=function(t){this.onScreenSharingCapabilitiesDetected.trigger(t);this.log("Screen sharing capabilities detected: "+n.Conference.ScreenSharingAvailabilityUtils.toString(t))},w.prototype.handleLocalScreenSharingStatusChanged=function(n){n?(this.wasVideoMutedBeforeSharingScreen=this.localEndpoint.isVideoMuted,this.localEndpoint.isVideoMuted&&this.muteVideoToggle()):this.wasVideoMutedBeforeSharingScreen&&!this.localEndpoint.isVideoMuted&&this.muteVideoToggle();this.localEndpoint.isSharingScreen=n;this.saveCallInformation();this.onScreenSharingStatusChanged.trigger(n);this.log("Local screen sharing status changed to: "+n)},w.prototype.handleRemoteScreenSharingStatusChanged=function(n){this.remoteEndpoint.isSharingScreen=n;this.saveCallInformation();this.onRemoteScreenSharingStatusChanged.trigger(n);this.log("Remote screen sharing status changed to: "+n)},w.prototype.handleLocalMediaAvailabilityChanged=function(n){this.updateMediaAvailability(n,this.localEndpoint);this.onLocalMediaAvailabilityChanged.trigger(n);this.currentCallType!=="screen-only-call"||n.available||n.media!=="video"||this.endCall(!1,t.EndCallCause.Cancelled)},w.prototype.handleRemoteMediaAvailabilityChanged=function(n){this.updateMediaAvailability(n,this.remoteEndpoint);this.onRemoteMediaAvailabilityChanged.trigger(n)},w.prototype.updateMediaAvailability=function(n,t){switch(n.media){case"audio":t.isAudioAvailable=n.available;break;case"video":t.isVideoAvailable=n.available}this.saveCallInformation()},w.prototype.handleProviderConferenceErrorEvent=function(n){var i=t.EndCallCause.GeneralError,u=t.EndCallCause.GeneralError,f;n.errorType===t.ProviderErrorType.ErrorGettingStunTurnServers?(i=t.EndCallCause.ErrorGettingStunTurnServers,u=t.EndCallCause.ErrorGettingStunTurnServers):(n.errorType===t.ProviderErrorType.MediaDevicesNotAllowed||n.errorType===t.ProviderErrorType.MediaDevicesSelectTimeout)&&(i=t.EndCallCause.LocalDeviceNotAllowed,u=t.EndCallCause.PeerDeviceNotAllowed);this.platform.send(t.Message.EndCall,this.currentSessionId,new r(this.currentSessionId,u));this.onCallEnded.trigger(new r(this.currentSessionId,i));this.conferenceProvider.end(i);this.removeCallInformation();this.setAsIdle();f=t.ProviderError.toString(n.errorType);this.log("Error: "+f)},w.prototype.handlePeerDisconnectedMessage=function(){this.log("Peer disconnected received");this.isIdle()||(this.conferenceProvider.end(t.EndCallCause.PeerDisconnected),this.onCallEnded.trigger(new r(this.currentSessionId,t.EndCallCause.PeerDisconnected)),this.removeCallInformation(),this.setAsIdle())},w.prototype.handleLocalMediaError=function(n){this.onLocalMediaError.trigger(n);this.currentCallType==="screen-only-call"&&n==="video"&&this.endCall(!1,t.EndCallCause.LocalDeviceNotAllowed)},w.prototype.handleSelfDisconnectedMessage=function(){this.log("Self-disconnection detected");this.isIdle()||(this.conferenceProvider.end(t.EndCallCause.LocalDisconnection),this.onCallEnded.trigger(new r(this.currentSessionId,t.EndCallCause.LocalDisconnection)),this.setAsIdle())},w.prototype.saveCallInformation=function(){if(this.isInCall()&&this.currentCallType!=="screen-only-call"){var n=new s(this.currentSessionId,this.currentCallType,this.localEndpoint,this.remoteEndpoint,this.iAmTheCaller);this.sessionStorageManager.set(e,n);this.log("Call information persisted")}},w.prototype.removeCallInformation=function(){var n=this.sessionStorageManager.get(e);n&&(this.sessionStorageManager.remove(e),this.log("Call information removed"))},w.prototype.changeStatusTo=function(n){this.log("Changing status to "+n);this.status=n;this.onStatusChanged.trigger(new y(this.currentSessionId,n))},w.prototype.log=function(n){this.logLevel&l.ConferenceCore&&console.log("[ConferenceCore] "+n)},w.prototype.installScreenSharingExtension=function(){this.conferenceProvider.installScreenSharingExtension()},w}(),i,f,s,h,c,a,w,r,u,o,v,y,l;t.ConferenceCore=b;i=function(){function n(n,t,i,r,u){this.isAudioAvailable=n;this.isAudioMuted=t;this.isVideoAvailable=i;this.isVideoMuted=r;this.isSharingScreen=u}return n.toString=function(n){if(!n)return"";var t=n.isSharingScreen?", Sharing screen":"";return"Audio ("+(n.isAudioAvailable?"Available":"Unavailable")+","+(n.isAudioMuted?"Muted":"Active")+"), Video ("+(n.isVideoAvailable?"Available":"Unavailable")+","+(n.isVideoMuted?"Muted":"Visible")+t+")"},n.create=function(t){return new n(t.isAudioAvailable,t.isAudioMuted,t.isVideoAvailable,t.isVideoMuted,t.isSharingScreen)},n.createEmpty=function(){return new n(!1,!1,!1,!1,!1)},n.createMicOnlyProperties=function(t){return new n(!0,t,!1,!1,!1)},n.createScreenSharingProperties=function(){return new n(!1,!1,!0,!1,!0)},n}();t.EndpointProperties=i;f=function(){function n(n,t,i){this.type=n;this.local=t;this.remote=i}return n.prototype.toString=function(){return"Type "+this.type+", Local("+i.toString(this.local)+"),Remote("+i.toString(this.remote)+")"},n}();t.CallProperties=f;s=function(n){function t(t,i,r,u,f){var e=n.call(this,i,r,u)||this;return e.id=t,e.iAmTheCaller=f,e.started=new Date,e}return __extends(t,n),t}(f);t.SaveCallInformation=s;h=function(){function n(n,t,i,r){this.sessionId=n;this.properties=t;this.resume=i;this.providerInformation=r}return n.prototype.toString=function(){return(this.resume?"Resume":"New call")+", Provider: "+this.providerInformation.providerName+", ID: "+this.sessionId+", "+this.properties.toString()+" "},n}();t.IncomingCallEventArgs=h;c=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.toString=function(){return n.prototype.toString.call(this)},t}(h);t.CallingEventArgs=c;a=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.toString=function(){return n.prototype.toString.call(this)},t}(c);t.CallStartedEventArgs=a;w=function(){function n(n,t){this.media=n;this.available=t}return n}();t.MediaAvailabilityChangedEventArgs=w;r=function(){function n(n,t){this.sessionId=n;this.cause=t}return n}();t.CallEndedEventArgs=r;u=function(){function n(n,t,i){this.sessionId=n;this.type=t;this.muted=i}return n}();t.MuteChangedEventArgs=u;o=function(){function n(n){this.sessionId=n}return n}();t.ConferenceEventArgs=o;v=function(){function n(n,t){this.sessionId=n;this.properties=t}return n}();t.CallMeToContinueConferenceEventArgs=v;y=function(){function n(n,t){this.sessionId=n;this.status=t}return n}();t.StatusChangeEventArgs=y,function(n){n[n.None=0]="None";n[n.ConferenceCore=1]="ConferenceCore";n[n.Provider=2]="Provider";n[n.ConferenceCoreAndProvider=3]="ConferenceCoreAndProvider"}(l=t.LogLevel||(t.LogLevel={}))})(t=n.Conference||(n.Conference={}))})(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var i=function(){function n(n,t){this.errorType=n;this.description=t}return n.toString=function(n){switch(n){case t.MediaDevicesNotAllowed:return"Video or audio device is not allowed";case t.MediaDevicesSelectTimeout:return"Video or audio not allowed due to timeout";case t.MediaDevicesError:return"Media devices error";case t.ErrorCreatingPeerConnection:return"Error creating peer connection";case t.ErrorCreatingSdpOffer:return"Error creating SDP offer";case t.ErrorInConnection:return"Connection error";case t.ErrorGettingStunTurnServers:return"Error getting STUN/TURN servers";case t.OpenTokErrorPublishing:return"Error publishing stream";case t.OpenTokErrorConnecting:return"Error connecting";case t.InitializationError:return"Error initializing provider"}return"Error ERR_"+n},n}(),t;n.ProviderError=i,function(n){n[n.MediaDevicesNotAllowed=0]="MediaDevicesNotAllowed";n[n.MediaDevicesSelectTimeout=1]="MediaDevicesSelectTimeout";n[n.MediaDevicesError=2]="MediaDevicesError";n[n.ErrorCreatingPeerConnection=3]="ErrorCreatingPeerConnection";n[n.ErrorCreatingSdpOffer=4]="ErrorCreatingSdpOffer";n[n.ErrorGettingStunTurnServers=5]="ErrorGettingStunTurnServers";n[n.ErrorInConnection=6]="ErrorInConnection";n[n.OpenTokErrorPublishing=7]="OpenTokErrorPublishing";n[n.OpenTokErrorConnecting=8]="OpenTokErrorConnecting";n[n.InitializationError=9]="InitializationError"}(t=n.ProviderErrorType||(n.ProviderErrorType={}))})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t;(function(n){n[n.Agent=0]="Agent";n[n.Visitor=1]="Visitor"})(t=n.ConferenceRole||(n.ConferenceRole={}))})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t,i;(function(n){n[n.PeerTimeout=0]="PeerTimeout";n[n.RejectedByPeer=1]="RejectedByPeer";n[n.PeerDeviceNotAllowed=2]="PeerDeviceNotAllowed";n[n.LocalDeviceNotAllowed=3]="LocalDeviceNotAllowed";n[n.PeerBusy=4]="PeerBusy";n[n.Cancelled=5]="Cancelled";n[n.Ended=6]="Ended";n[n.PeerDisconnected=7]="PeerDisconnected";n[n.LocalDisconnection=8]="LocalDisconnection";n[n.ConnectionError=9]="ConnectionError";n[n.ErrorGettingStunTurnServers=10]="ErrorGettingStunTurnServers";n[n.GeneralError=11]="GeneralError";n[n.InvalidProvider=12]="InvalidProvider"})(t=n.EndCallCause||(n.EndCallCause={}));i=function(){function n(){}return n.toString=function(n){switch(n){case t.PeerTimeout:return"Call not answered. Reason: ";case t.RejectedByPeer:return"Call rejected";case t.PeerDeviceNotAllowed:return"Remote devices not allowed";case t.LocalDeviceNotAllowed:return"Local devices not allowed";case t.PeerBusy:return"The remote peer is busy";case t.Cancelled:return"Call cancelled";case t.Ended:return"Call ended";case t.PeerDisconnected:return"Peer disconnected";case t.LocalDisconnection:return"Local disconnection";case t.ConnectionError:return"Connection error";case t.ErrorGettingStunTurnServers:return"Error getting stun/turn servers";case t.InvalidProvider:return"Invalid conference provider";default:return"General error"}},n}();n.EndCallCausesUtils=i})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t;(function(n){n[n.RequestConference=0]="RequestConference";n[n.CallAccepted=1]="CallAccepted";n[n.EndCall=2]="EndCall";n[n.MuteChanged=3]="MuteChanged";n[n.DevicePermissionDialog=4]="DevicePermissionDialog";n[n.CallMeToContinueConference=5]="CallMeToContinueConference";n[n.PeerDisconnected=99]="PeerDisconnected"})(t=n.Message||(n.Message={}))})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(t){var i=function(){function i(t,i,r){r===void 0&&(r=!1);this.channel=t;this.conferenceControllerBasePath=i;this.enableLogging=r;this.onIncomingCallReceived=new n.Event;this.onCallAcceptedReceived=new n.Event;this.onCallMeToContinueConferenceReceived=new n.Event;this.onEndCallReceived=new n.Event;this.onPeerDisconnected=new n.Event;this.onSelfDisconnected=new n.Event;this.onRemoteMuteChanged=new n.Event;this.onSignalingMessage=new n.Event;i&&i.length?i[i.lengt-1]!=="/"&&(this.conferenceControllerBasePath+="/"):console.error("Can't create the platform connector because the 'conferenceControllerBasePath' is not specified")}return i.prototype.send=function(n,i,r){r===void 0&&(r=null);n===t.Message.EndCall&&this.enableLogging&&console.log("[Connector] Connector sends **END CALL, "+t.EndCallCausesUtils.toString(r.cause)+" **");this.channel.sendConferenceMessage(n,i,r)},i.prototype.sendSignalingMessage=function(n,t){this.channel.sendSignalingMessage(JSON.stringify(n),t)},i.prototype.getWebRtcProviderIceServers=function(){return this.postToConferenceController("getIceServers")},i.prototype.createOpenTokSession=function(n,t){return this.postToConferenceController("createOpenTokSession",{sessionId:n,autoRecording:t})},i.prototype.getOpenTokAccessToken=function(n,t){return this.postToConferenceController("GetOpenTokUsertoken",{sessionId:n,opentokSessionId:t})},i.prototype.startOpentokRecording=function(n,t){return this.postToConferenceController("StartOpenTokRecording",{sessionId:n,opentokSessionId:t})},i.prototype.stopOpentokRecording=function(n,t){return this.postToConferenceController("StopOpenTokRecording",{sessionId:n,archiveId:t})},i.prototype.processSignalingMessage=function(n){this.onSignalingMessage.trigger(n)},i.prototype.processConferenceMessage=function(n,i){i===void 0&&(i=null);switch(n){case t.Message.RequestConference:this.onIncomingCallReceived.trigger(i);break;case t.Message.CallAccepted:this.onCallAcceptedReceived.trigger(i);break;case t.Message.PeerDisconnected:this.onPeerDisconnected.trigger(i);break;case t.Message.MuteChanged:this.onRemoteMuteChanged.trigger(i);break;case t.Message.CallMeToContinueConference:this.onCallMeToContinueConferenceReceived.trigger(i);break;case t.Message.EndCall:this.onEndCallReceived.trigger(i)}},i.prototype.postToConferenceController=function(n,t){function r(n){return Object.keys(n).reduce(function(t,i){return t.push(i+"="+encodeURIComponent(n[i])),t},[]).join("&")}var i=this;return t===void 0&&(t=null),new Promise(function(u,f){var e=new XMLHttpRequest,o=i.conferenceControllerBasePath+n;e.open("POST",o);e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.onreadystatechange=function(){if(e.readyState===4)if(e.status===200){var n=JSON.parse(e.responseText);u(n)}else f("Error "+e.status+": "+e.statusText+"\n"+e.responseText)};e.send(t?r(t):null)})},i}();t.PlatformConnector=i})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var i=function(){function n(n,t){this.errorType=n;this.description=t}return n.toString=function(n){switch(n){case t.MediaDevicesNotAllowed:return"Video or audio device is not allowed";case t.MediaDevicesSelectTimeout:return"Video or audio not allowed due to timeout";case t.MediaDevicesError:return"Media devices error";case t.ErrorCreatingPeerConnection:return"Error creating peer connection";case t.ErrorCreatingSdpOffer:return"Error creating SDP offer";case t.ErrorInConnection:return"Connection error";case t.ErrorGettingStunTurnServers:return"Error getting STUN/TURN servers";case t.OpenTokErrorPublishing:return"Error publishing stream";case t.OpenTokErrorConnecting:return"Error connecting";case t.InitializationError:return"Error initializing provider"}return"Error ERR_"+n},n}(),t;n.ProviderError=i,function(n){n[n.MediaDevicesNotAllowed=0]="MediaDevicesNotAllowed";n[n.MediaDevicesSelectTimeout=1]="MediaDevicesSelectTimeout";n[n.MediaDevicesError=2]="MediaDevicesError";n[n.ErrorCreatingPeerConnection=3]="ErrorCreatingPeerConnection";n[n.ErrorCreatingSdpOffer=4]="ErrorCreatingSdpOffer";n[n.ErrorGettingStunTurnServers=5]="ErrorGettingStunTurnServers";n[n.ErrorInConnection=6]="ErrorInConnection";n[n.OpenTokErrorPublishing=7]="OpenTokErrorPublishing";n[n.OpenTokErrorConnecting=8]="OpenTokErrorConnecting";n[n.InitializationError=9]="InitializationError"}(t=n.ProviderErrorType||(n.ProviderErrorType={}))})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t=function(){function n(n,t){this.providerName=n;this.extraData=t}return n}();n.ProviderInformation=t})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t,i;(function(n){n[n.InstalledAndEnabled=0]="InstalledAndEnabled";n[n.InstalledAndDisabled=1]="InstalledAndDisabled";n[n.NotInstalled=2]="NotInstalled";n[n.NotSupported=3]="NotSupported"})(t=n.ScreenSharingAvailability||(n.ScreenSharingAvailability={}));i=function(){function n(){}return n.toString=function(n){switch(n){case t.NotSupported:return"Not supported";case t.InstalledAndDisabled:return"Extension installed and disabled";case t.NotInstalled:return"Extension not installed";case t.InstalledAndEnabled:return"Extension installed and enabled. Ok :)"}throw"Invalid screen capture status: "+n;},n}();n.ScreenSharingAvailabilityUtils=i})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t=function(){function n(){}return n.prototype.set=function(n,t){this.isSessionStorageAvailable()&&window.sessionStorage.setItem(n,JSON.stringify(t))},n.prototype.get=function(n){return this.isSessionStorageAvailable()?JSON.parse(window.sessionStorage.getItem(n)):null},n.prototype.remove=function(n){this.isSessionStorageAvailable()&&window.sessionStorage.removeItem(n)},n.prototype.isSessionStorageAvailable=function(){try{return"sessionStorage"in window&&window.sessionStorage!==null}catch(n){return!1}},n}();n.SessionStorageManager=t})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(t):n.ES6Promise=t()}(this,function(){"use strict";function pt(n){return typeof n=="function"||typeof n=="object"&&n!==null}function ut(n){return typeof n=="function"}function wt(n){b=n}function bt(n){r=n}function gt(){return function(){return process.nextTick(e)}}function ni(){return typeof w!="undefined"?function(){w(e)}:k()}function ti(){var n=0,i=new ht(e),t=document.createTextNode("");return i.observe(t,{characterData:!0}),function(){t.data=n=++n%2}}function ii(){var n=new MessageChannel;return n.port1.onmessage=e,function(){return n.port2.postMessage(0)}}function k(){var n=setTimeout;return function(){return n(e,1)}}function e(){for(var t,i,n=0;n<f;n+=2)t=u[n],i=u[n+1],t(i),u[n]=undefined,u[n+1]=undefined;f=0}function ri(){try{var t=require,n=t("vertx");return w=n.runOnLoop||n.runOnContext,ni()}catch(i){return k()}}function g(n,t){var e=arguments,f=this,i=new this.constructor(o),u;return i[c]===undefined&&yt(i),u=f._state,u?function(){var n=e[u-1];r(function(){return vt(u,i,n,f._result)})}():tt(f,i,n,t),i}function nt(n){var i=this,t;return n&&typeof n=="object"&&n.constructor===i?n:(t=new i(o),a(t,n),t)}function o(){}function ui(){return new TypeError("You cannot resolve a promise with itself")}function fi(){return new TypeError("A promises callback cannot return that same promise.")}function ct(n){try{return n.then}catch(t){return y.error=t,y}}function ei(n,t,i,r){try{n.call(t,i,r)}catch(u){return u}}function oi(n,u,f){r(function(n){var r=!1,e=ei(f,u,function(t){r||(r=!0,u!==t?a(n,t):i(n,t))},function(i){r||(r=!0,t(n,i))},"Settle: "+(n._label||" unknown promise"));!r&&e&&(r=!0,t(n,e))},n)}function si(n,r){r._state===l?i(n,r._result):r._state===h?t(n,r._result):tt(r,undefined,function(t){return a(n,t)},function(i){return t(n,i)})}function lt(n,r,u){r.constructor===n.constructor&&u===g&&r.constructor.resolve===nt?si(n,r):u===y?t(n,y.error):u===undefined?i(n,r):ut(u)?oi(n,r,u):i(n,r)}function a(n,r){n===r?t(n,ui()):pt(r)?lt(n,r,ct(r)):i(n,r)}function hi(n){n._onerror&&n._onerror(n._result);it(n)}function i(n,t){n._state===s&&(n._result=t,n._state=l,n._subscribers.length!==0&&r(it,n))}function t(n,t){n._state===s&&(n._state=h,n._result=t,r(hi,n))}function tt(n,t,i,u){var f=n._subscribers,e=f.length;n._onerror=null;f[e]=t;f[e+l]=i;f[e+h]=u;e===0&&n._state&&r(it,n)}function it(n){var i=n._subscribers,f=n._state,t;if(i.length!==0){var r=undefined,u=undefined,e=n._result;for(t=0;t<i.length;t+=3)r=i[t],u=i[t+f],r?vt(f,r,u,e):u(e);n._subscribers.length=0}}function at(){this.error=null}function ci(n,t){try{return n(t)}catch(i){return p.error=i,p}}function vt(n,r,u,f){var c=ut(u),e=undefined,v=undefined,o=undefined,y=undefined;if(c){if(e=ci(u,f),e===p?(y=!0,v=e.error,e=null):o=!0,r===e){t(r,fi());return}}else e=f,o=!0;r._state!==s||(c&&o?a(r,e):y?t(r,v):n===l?i(r,e):n===h&&t(r,e))}function li(n,i){try{i(function(t){a(n,t)},function(i){t(n,i)})}catch(r){t(n,r)}}function ai(){return rt++}function yt(n){n[c]=rt++;n._state=undefined;n._result=undefined;n._subscribers=[]}function v(n,r){this._instanceConstructor=n;this.promise=new n(o);this.promise[c]||yt(this.promise);et(r)?(this._input=r,this.length=r.length,this._remaining=r.length,this._result=new Array(this.length),this.length===0?i(this.promise,this._result):(this.length=this.length||0,this._enumerate(),this._remaining===0&&i(this.promise,this._result))):t(this.promise,vi())}function vi(){return new Error("Array Methods must be provided an Array")}function yi(n){return new v(this,n).promise}function pi(n){var t=this;return et(n)?new t(function(i,r){for(var f=n.length,u=0;u<f;u++)t.resolve(n[u]).then(i,r)}):new t(function(n,t){return t(new TypeError("You must pass an array to race."))})}function wi(n){var r=this,i=new r(o);return t(i,n),i}function bi(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");}function ki(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");}function n(t){this[c]=ai();this._result=this._state=undefined;this._subscribers=[];o!==t&&(typeof t!="function"&&bi(),this instanceof n?li(this,t):ki())}function di(){var t=undefined,i,r;if(typeof global!="undefined")t=global;else if(typeof self!="undefined")t=self;else try{t=Function("return this")()}catch(u){throw new Error("polyfill failed because global object is unavailable in this environment");}if(i=t.Promise,i){r=null;try{r=Object.prototype.toString.call(i.resolve())}catch(u){}if(r==="[object Promise]"&&!i.cast)return}t.Promise=n}var ft=undefined,u,d,c,p,rt;ft=Array.isArray?Array.isArray:function(n){return Object.prototype.toString.call(n)==="[object Array]"};var et=ft,f=0,w=undefined,b=undefined,r=function(n,t){u[f]=n;u[f+1]=t;f+=2;f===2&&(b?b(e):d())};var ot=typeof window!="undefined"?window:undefined,st=ot||{},ht=st.MutationObserver||st.WebKitMutationObserver,kt=typeof self=="undefined"&&typeof process!="undefined"&&{}.toString.call(process)==="[object process]",dt=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined";u=new Array(1e3);d=undefined;d=kt?gt():ht?ti():dt?ii():ot===undefined&&typeof require=="function"?ri():k();c=Math.random().toString(36).substring(16);var s=void 0,l=1,h=2,y=new at;return p=new at,rt=0,v.prototype._enumerate=function(){for(var t=this.length,i=this._input,n=0;this._state===s&&n<t;n++)this._eachEntry(i[n],n)},v.prototype._eachEntry=function(t,i){var r=this._instanceConstructor,e=r.resolve,u,f;e===nt?(u=ct(t),u===g&&t._state!==s?this._settledAt(t._state,i,t._result):typeof u!="function"?(this._remaining--,this._result[i]=t):r===n?(f=new r(o),lt(f,t,u),this._willSettleAt(f,i)):this._willSettleAt(new r(function(n){return n(t)}),i)):this._willSettleAt(e(t),i)},v.prototype._settledAt=function(n,r,u){var f=this.promise;f._state===s&&(this._remaining--,n===h?t(f,u):this._result[r]=u);this._remaining===0&&i(f,this._result)},v.prototype._willSettleAt=function(n,t){var i=this;tt(n,undefined,function(n){return i._settledAt(l,t,n)},function(n){return i._settledAt(h,t,n)})},n.all=yi,n.race=pi,n.resolve=nt,n.reject=wi,n._setScheduler=wt,n._setAsap=bt,n._asap=r,n.prototype={constructor:n,then:g,"catch":function(n){return this.then(null,n)}},n.polyfill=di,n.Promise=n,n}),function(n){var t=function(){function n(){this.handlers=[]}return n.prototype.on=function(n){this.handlers.push(n)},n.prototype.off=function(n){n===void 0&&(n=null);n==null?this.handlers.length=0:this.handlers=this.handlers.filter(function(t){return t!==n})},n.prototype.trigger=function(n){this.handlers.slice(0).forEach(function(t){return t(n)})},n}();n.Event=t}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n}();n.Capabilities=t})(t=n.WebRtc||(n.WebRtc={}))})(t=n.Providers||(n.Providers={}))})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function t(){}return t.createCapabilityProvider=function(t,i){switch(t.toLowerCase()){case"webrtc":return new n.WebRtc.WebRtcCapabilitiesProvider;case"opentok":return new n.OpenTok.OpenTokCapabilitiesProvider(i)}throw"The provider '"+t+"' has not a capability provider defined";},t}();n.CapabilitiesProviderFactory=t})(t=n.Providers||(n.Providers={}))})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function t(){}return t.createCapabilityProvider=function(t){switch(t.toLowerCase()){case"webrtc":return new n.WebRtc.WebRtcCapabilitiesProvider;case"opentok":return new n.OpenTok.OpenTokCapabilitiesProvider}throw"The provider '"+t+"' has not a capability provider defined";},t}();n.CapabilityProviderFactory=t})(t=n.Providers||(n.Providers={}))})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this.sessionId=n;this.properties=t}return n.prototype.toString=function(){return"ID: "+this.sessionId+", "+this.properties.toString()},n}();n.ConferenceStartOptions=t})(t=n.Providers||(n.Providers={}))})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n}();n.ProviderCapabilities=t})(t=n.Providers||(n.Providers={}))})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function t(){}return t.createProvider=function(t,i,r,u,f){var o,e;try{switch(t.toLowerCase()){case"webrtc":return o=new n.WebRtc.WebRtcSettings,o.logging=r,o.chromeExtensionId=u.chromeExtensionId,new n.WebRtc.WebRtcProvider(o,i);case"opentok":return e=new n.OpenTok.OpenTokSettings,e.logging=r,e.name=u.name,e.role=u.role,e.videoUnavailableBackgroundImage=u.videoUnavailableBackgroundImage,e.chromeExtensionId=u.chromeExtensionId,e.recordingMode=u.recordingMode,new n.OpenTok.OpenTokProvider(e,i,f);default:throw"The provider '"+t+"' is not supported";}}catch(s){throw s||"Error creating provider '"+t+"'";}},t}();n.ProviderFactory=t})(t=n.Providers||(n.Providers={}))})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={}));var ConferenceRole=Oct8ne.Conference.ConferenceRole,ConferenceCore=Oct8ne.Conference.ConferenceCore,LogLevel=Oct8ne.Conference.LogLevel,EndCallCause=Oct8ne.Conference.EndCallCause;conferenceViewModel=function(n,t){var i=this;this.settings=n;this.isRinging=!1;this.isConferenceAllowed=ko.observable(!1);this.isAudioDeviceAvailable=ko.observable(!1);this.isVideoDeviceAvailable=ko.observable(!1);this.canStartVideoCall=ko.computed(function(){return i.isAudioDeviceAvailable()&&i.isVideoDeviceAvailable()&&!i.hideStartCallButtons()});this.canStartAudioCall=ko.computed(function(){return i.isAudioDeviceAvailable()&&!i.hideStartCallButtons()});this.informationMessage=ko.observable(null);this.informationMessageIsError=ko.observable(!1);this.status=ko.observable("Idle");this.isCalling=ko.computed(function(){return i.status()==="Calling"});this.isIdle=ko.computed(function(){return i.status()==="Idle"});this.isConnecting=ko.computed(function(){return i.status()==="Connecting"});this.isReceivingCall=ko.computed(function(){return i.status()==="ReceivingCall"});this.isInCall=ko.computed(function(){return i.status()==="InCall"});this.isInAudioCall=ko.computed(function(){return i.isInCall()&&!i.isLocalVideoAvailable()&&!i.isRemoteVideoAvailable()&&(i.isRemoteVideoAvailable()||i.isLocalAudioAvailable())});this.isInVideoCall=ko.computed(function(){return i.isInCall()&&(i.isLocalVideoAvailable()||i.isRemoteVideoAvailable())});this.isLocalAudioMuted=ko.observable(!1);this.isLocalVideoMuted=ko.observable(!1);this.isLocalVideoAvailable=ko.observable(!1);this.isLocalAudioAvailable=ko.observable(!1);this.isRemoteAudioMuted=ko.observable(!1);this.isRemoteVideoMuted=ko.observable(!1);this.isRemoteVideoAvailable=ko.observable(!1);this.isRecording=ko.observable(!1);this.provider=ko.observable("");this.zoomLevel=ko.observable(0);this.isSharingScreen=ko.observable(!1);this.isScreenSharingSupported=ko.observable(!1);this.isScreenSharingAvailable=ko.observable(!1);this.autoAnswerCalls=ko.observable(!1);this.screenSharingOnly=ko.observable(n.ssOnly);this.screenSharingOnly()&&i.autoAnswerCalls(!0);Error.stackTraceLimit=1e3;n.ringTone&&(this.ringTone=new Audio($o.core.globalVariables.cdnUrl+"api/sound/ring.mp3?"+Math.round((new Date).getTime()/864e5)),this.ringTone.loop=!0,this.ringTone.load());this.provider(n.conferenceProviderName.toLowerCase());this.role=n.role;this.conferenceCore=new ConferenceCore(n,t,$o.storage.conferenceAdapter,LogLevel.None);this.showLocalVideoUi=ko.computed(function(){return i.isCalling()||i.isInCall()||i.isConnecting()});this.addingExtensionLay=ko.observable(!1);this.isFullWidth=ko.observable(!1);this.avoidMultiClick=ko.observable(!1);this.onHoldByTransfer=ko.observable(!1);this.appBackgroundAdvice=ko.observable(!1);this.toDestroyTimeSecs=ko.observable(0);this.hideStartCallButtons=ko.observable(!1);this.isOpentok=ko.computed(function(){return i.provider()==="opentok"?!0:!1});this.conferenceCore.onCalling.on(function(n){i.showInformation(culture.conference.VCCalling);i.currentConferenceId=n.sessionId;n.resume||i.startRingTone()});this.conferenceCore.onLocalMediaAvailabilityChanged.on(function(n){switch(n.media){case"video":i.isLocalVideoAvailable(n.available);break;case"audio":i.isLocalAudioAvailable(n.available)}});this.conferenceCore.onRemoteMediaAvailabilityChanged.on(function(n){n.media==="video"&&(i.isRemoteVideoAvailable(n.available),n.available&&!i.isLocalVideoAvailable()&&i.zoomLevel==0&&$o.visitorStart.collpaseChatComunications(),n.available||(i.isRemoteVideoMuted(!1),i.isFullWidth()&&i.returnNormalSizeClicked(),i.isLocalVideoAvailable()||(i.zoomLevel!=0&&i.zoomLevel(0),$o.visitorStart.collpaseChatComunications())))});this.conferenceCore.onOutgoingCallNotAnswered.on(function(){i.stopRingTone();i.showError(culture.conference.VCNotAnswered)});this.conferenceCore.onIncomingCall.on(function(n){i.currentConferenceId=n.sessionId;i.startRingTone()});this.conferenceCore.onIncomingCallAccepted.on(function(){i.stopRingTone();i.showInformation(culture.conference.VCAccepted)});this.conferenceCore.onLocalMediaError.on(function(n){n==="video"?i.isVideoDeviceAvailable(!1):n==="audio"&&i.isAudioDeviceAvailable(!1);i.isAudioDeviceAvailable()||i.isVideoDeviceAvailable()||(i.informationMessageIsError(!0),i.informationMessage("No devices available"))});this.conferenceCore.onCallStarted.on(function(n){i.stopRingTone();n.resume?i.showInformation(culture.conference.VCResumed):i.showInformation(culture.conference.VCStarted);i.currentConferenceId=n.sessionId;i.provider()==="webrtc"&&i.screenSharingOnly()||$o.visitorStart.collpaseChatComunications();$o.inactivity.stopProcess();$o.inactivityAgent.clearTimerInterval();i.startConferenceInterval();$o.saveRecord.conference(4,$o.core.conferenceVars.STARTED,n.properties.type);$.connection.hubInterface.server.updateStatusCallInDic($o.core.globalVariables.room,n.properties.type);n.properties.type==="audio-call"&&$.connection.hubInterface.server.updateVisitorMuteVideoInDic($o.core.globalVariables.room,!0);$.connection.hubInterface.server.markAsTransferredInVideoCallInDic($o.core.globalVariables.room,null);i.onHoldByTransfer(!1);i.autoAnswerCalls(!1);i.screenSharingOnly()&&i.autoAnswerCalls(!0)});this.conferenceCore.onLocalMuteChanged.on(function(n){n.type==="audio"?(i.isLocalAudioMuted(n.muted),$.connection.hubInterface.server.updateVisitorMuteAudioInDic($o.core.globalVariables.room,n.muted)):i.isLocalVideoMuted(n.muted)});this.conferenceCore.onRemoteMuteChanged.on(function(n){n.type==="audio"?(i.isRemoteAudioMuted(n.muted),i.showInformation(n.muted?culture.conference.VCAudioMute:culture.conference.VCAudioUnmute)):(i.isRemoteVideoMuted(n.muted),i.showInformation(n.muted?culture.conference.VCVideoMute:culture.conference.VCVideUnmute))});this.conferenceCore.onCallEnded.on(function(n){i.stopRingTone();i.showError(EndCallCauses.toString(n.cause));$o.visitorStart.resetChatComunications();i.clearConferenceInterval(n.cause);i.avoidMultiClick(!1);$.connection.hubInterface.server.updateStatusCallInDic($o.core.globalVariables.room,null)});this.conferenceCore.onStatusChanged.on(function(n){i.status(n.status);i.isIdle()&&(i.zoomLevel(0),i.isRemoteAudioMuted(!1),i.isRemoteVideoMuted(!1),i.isRemoteVideoAvailable(!1),i.isLocalVideoAvailable(!1),i.isLocalAudioAvailable(!1),i.isLocalAudioMuted(!1),i.isLocalVideoMuted(!1),i.isSharingScreen(!1),i.isFullWidth()&&i.returnNormalSizeClicked())});this.conferenceCore.onScreenSharingCapabilitiesDetected.on(function(n){i.isScreenSharingAvailable(n===Oct8ne.Conference.ScreenSharingAvailability.InstalledAndEnabled);i.isScreenSharingSupported(n!==Oct8ne.Conference.ScreenSharingAvailability.NotSupported)});this.conferenceCore.onScreenSharingStatusChanged.on(function(n){i.isSharingScreen(n)});this.conferenceCore.onRemoteScreenSharingStatusChanged.on(function(n){n&&(i.informationMessageIsError(!1),i.informationMessage("The remote peer is sharing the screen"),i.expandViewClicked())});this.autoAnswerCalls.subscribe(function(n){i.conferenceCore.autoAnswerCalls=n});this.conferenceCore.autoAnswerCalls=this.autoAnswerCalls();this.startAudioConferenceClicked=function(n){i.avoidMultiClick()||(i.avoidMultiClick(!0),$o.variablesVisitor.status=="Searching"?$o.visitorSearch.changeToWaitingStatus(!1,function(n){i.conferenceCore.startCall("audio-call",n)}):i.conferenceCore.startCall("audio-call",n),$o.saveRecord.conference(3,$o.core.conferenceVars.STARTING,"audio-call"))};this.startVideoConferenceClicked=function(n){i.avoidMultiClick()||(i.avoidMultiClick(!0),$o.variablesVisitor.status=="Searching"?$o.visitorSearch.changeToWaitingStatus(!1,function(n){i.conferenceCore.startCall("video-call",n)}):i.conferenceCore.startCall("video-call",n),$o.saveRecord.conference(3,$o.core.conferenceVars.STARTING,"video-call"))};this.startScreenSharingOnlyCallClicked=function(n){$o.variablesVisitor.status=="Searching"?$o.visitorSearch.changeToWaitingStatus(!1,function(n){i.installExtensionFlow(n)}):i.installExtensionFlow(n)};this.installExtensionFlow=function(n,t){var r,u;if(i.isScreenSharingSupported()&&!i.isScreenSharingAvailable()){r={Body:{Original:"",Translated:!1},Room:$o.core.globalVariables.room,Category:"CANNED",Type:$o.canned.type.EXTENSIONADVICE,Id:$o.tools.generateRandomId(),SentBy:$o.core.globalVariables.userType};$o.canned.createCanned(r);return}u=["ss-clicked"];$o.forms.sendFormResponse(t,u);i.conferenceCore.startCall("screen-only-call",n);$o.saveRecord.conference(3,$o.core.conferenceVars.STARTING,"screen-only-call")};this.startVideoClicked=function(){i.conferenceCore.startVideo();$o.saveRecord.conference(3,$o.core.conferenceVars.STARTINGCAM,"video-call");$.connection.hubInterface.server.updateVisitorMuteVideoInDic($o.core.globalVariables.room,!1)};this.stopVideoClicked=function(){i.conferenceCore.stopVideo();$o.saveRecord.conference(3,$o.core.conferenceVars.ENDCAM,"video-call");$.connection.hubInterface.server.updateVisitorMuteVideoInDic($o.core.globalVariables.room,!0);i.isRemoteVideoAvailable()||(i.zoomLevel!=0&&i.zoomLevel(0),$o.visitorStart.collpaseChatComunications())};this.startScreenSharingClicked=function(){if(i.isScreenSharingSupported()&&!i.isScreenSharingAvailable()){var n=$("#crhome-extension-link a").attr("href");window.open(n);i.addingExtensionLay(!0)}else this.isSharingScreen()?(i.conferenceCore.stopScreenSharing(),$o.saveRecord.conference(3,$o.core.conferenceVars.SCREENSHARED,!1)):(i.conferenceCore.startScreenSharing(),$o.saveRecord.conference(3,$o.core.conferenceVars.SCREENSHARED,!0))};this.installScreenSharingExtension=function(){i.conferenceCore.installScreenSharingExtension()};this.closeAddExtensionLay=function(){i.addingExtensionLay(!1)};this.refreshLocation=function(){parent.postMessage("REFRESHPAGE","*")};this.initOnHoldState=function(n){if(n){i.onHoldByTransfer(!0);i.autoAnswerCalls(!0)}};this.receiveRejectedVideoCall=function(){i.onHoldByTransfer(!1);i.autoAnswerCalls(!1);i.screenSharingOnly()&&i.autoAnswerCalls(!0);$.connection.hubInterface.server.markAsTransferredInVideoCallInDic($o.core.globalVariables.room,null);$o.visitorStart.resetChatComunications()};this.receiveOnBackgroundApp=function(){i.appBackgroundAdvice(!0);i.toDestroyInterval=setInterval(i.conferenceDestroyLapse,1e3)};this.conferenceDestroyLapse=function(){i.toDestroyTimeSecs(i.toDestroyTimeSecs()+1);i.toDestroyTimeSecs()>20&&(clearInterval(i.toDestroyInterval),i.appBackgroundAdvice(!1),i.toDestroyTimeSecs(0),i.endCallClicked())};this.receiveOnForegroundApp=function(){i.toDestroyInterval!==null&&(clearInterval(i.toDestroyInterval),i.appBackgroundAdvice(!1),i.toDestroyTimeSecs(0))};this.resumeCallIfNeeded=function(){i.isConferenceAllowed()&&i.conferenceCore.resumeCallIfNeeded()};this.expandViewClicked=function(){var n=(i.zoomLevel()+1)%3;i.zoomLevel(n);$o.visitorStart.expandChatComunications()};this.reduceViewClicked=function(){var n=i.zoomLevel()-1;n<0&&(n=0);i.zoomLevel(n);$o.visitorStart.collpaseChatComunications()};this.acceptCallClicked=function(){i.conferenceCore.acceptCall();$o.saveRecord.conference(3,$o.core.conferenceVars.ACCEPT)};this.endCallClicked=function(){i.conferenceCore.endCall();$o.saveRecord.conference(3,$o.core.conferenceVars.END);$.connection.hubInterface.server.markAsTransferredInVideoCallInDic($o.core.globalVariables.room,null)};this.muteAudioClicked=function(){i.conferenceCore.muteAudioToggle()};this.muteVideoClicked=function(){i.conferenceCore.muteVideoToggle()};this.toggleCam=function(){i.conferenceCore.toggleCam()};this.updateSessionInfo=function(n){i.isConferenceAllowed(n.visitor.hasAudioDevices);var t=i.role===ConferenceRole.Agent?n.agent:n.visitor;i.isAudioDeviceAvailable(n.visitor.hasAudioDevices);i.isVideoDeviceAvailable(n.visitor.hasVideoDevices)};this.showInformation=function(n){i.informationMessage(n);i.informationMessageIsError(!1)};this.clearInformation=function(){i.informationMessage(null);i.informationMessageIsError(!1)};this.fullWidthClicked=function(){parent.postMessage("FULLSCREENSIZE","*");i.isFullWidth(!0)};this.returnNormalSizeClicked=function(){parent.postMessage("NORMALSCREENSIZE","*");i.isFullWidth(!1)};this.showError=function(n){i.informationMessage()!==culture.conference.VCRemoteBusy&&(i.informationMessage(n),i.informationMessageIsError(!0))};this.startRingTone=function(){if(i.settings.ringTone)try{i.ringTone.paused&&(i.ringTone.currentTime=0,i.ringTone.play())}catch(n){}};this.stopRingTone=function(){var n=this;if(i.settings.ringTone)try{setTimeout(function(){n.ringTone.paused||n.ringTone.pause()},100)}catch(t){}};this.startConferenceInterval=function(){i.conferenceInterval=setInterval(conferenceTimeLapse,1e3)};this.clearConferenceInterval=function(n,t){clearInterval(i.conferenceInterval);resetConferenceTimeSecs(n,t)};this.removeCallInformation=function(){i.conferenceCore.removeCallInformation()};this.conferenceInterval=null;this.toDestroyInterval=null};ko.bindingHandlers.inlineBlock={update:function(n,t){var i=ko.unwrap(t()),r=n.style.display!=="none";i&&!r?n.style.display="inline-block":!i&&r&&$(n).hide()}};ko.bindingHandlers.temporalMessage={update:function(n,t,i){var r=t(),u=ko.utils.unwrapObservable(r),f=i.get("temporalDuration")||5e3;u?(n.temporalTimeout&&(clearTimeout(n.temporalTimeout),$(n).hide()),$(n).html(u),$(n).show(),n.temporalTimeout=setTimeout(function(){$(n).hide();n.temporalTimeout=0;r(null)},f)):n.temporalTimeout&&(clearTimeout(n.temporalTimeout),$(n).hide())}};var conferenceTimeSecs=0,EndCallCauses=function(){function n(){}return n.toString=function(n){switch(n){case EndCallCause.PeerTimeout:return culture.conference.VCNotAnswered;case EndCallCause.RejectedByPeer:return culture.conference.VCNotAnswered;case EndCallCause.PeerDeviceNotAllowed:return culture.conference.VCCantAcces;case EndCallCause.LocalDeviceNotAllowed:return culture.conference.VCDeviceNotAllowed;case EndCallCause.PeerBusy:return culture.conference.VCRemoteBusy;case EndCallCause.Cancelled:return culture.conference.VCCancelled;case EndCallCause.Ended:return culture.conference.VCEnded;case EndCallCause.PeerDisconnected:return culture.conference.VCPeerDisc;case EndCallCause.LocalDisconnection:return culture.conference.VCYouDisc;case EndCallCause.ConnectionError:return culture.conference.VCConnectionError;case EndCallCause.ErrorGettingStunTurnServers:return culture.conference.VCStunTurnServerError;case EndCallCause.InvalidProvider:return culture.conference.VCInvalidProvider;default:return culture.conference.VCGeneralError}},n}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Oct8ne;(function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=n.Providers.WebRtc.Capabilities,r=function(){function t(n){this.chromeExtensionId=n}return t.prototype.getCapabilitiesAsync=function(){var r=this,t;return typeof Promise=="undefined"&&ES6Promise.polyfill(),t=function(t,u){return __awaiter(r,void 0,void 0,function(){var e,f,o,s,r,h=this;return __generator(this,function(){if(e=window.navigator.userAgent.toLowerCase(),f=window.navigator.appName,o=f==="Microsoft Internet Explorer"||f==="Netscape"&&e.indexOf("trident")>-1,o&&!OT.checkSystemRequirements())return OT.upgradeSystemRequirements(),u(),[2];if(s=OT.checkSystemRequirements(),r=new i,s===1)OT.getDevices(function(i,u){return __awaiter(h,void 0,void 0,function(){var i,f,e;return __generator(this,function(o){switch(o.label){case 0:for(r.hasAudioDevices=!1,r.hasVideoDevices=!1,i=0;i<u.length;i++)f=u[i].kind,f==="videoInput"?r.hasVideoDevices=!0:f==="audioInput"&&(r.hasAudioDevices=!0);return r.browser="unknown",r.isWebRtcSupported=!0,[4,this.getScreenSharingCapabilitiesAsync()];case 1:return e=o.sent(),r.canShareScreen=e===n.ScreenSharingAvailability.InstalledAndEnabled,t(r),[2]}})})});else return r.browser="unknown",r.hasAudioDevices=!1,r.hasVideoDevices=!1,r.isWebRtcSupported=!1,t(r),[2];return[2]})})},new Promise(t)},t.prototype.getScreenSharingCapabilitiesAsync=function(){var t=this;return typeof Promise=="undefined"&&ES6Promise.polyfill(),new Promise(function(i){OT.registerScreenSharingExtension("chrome",t.chromeExtensionId,2);OT.checkScreenSharingCapability(function(t){var r;r=!t.supported||t.extensionRequired&&t.extensionRegistered===!1?n.ScreenSharingAvailability.NotInstalled:t.extensionRequired&&t.extensionInstalled===!1?n.ScreenSharingAvailability.NotInstalled:n.ScreenSharingAvailability.InstalledAndEnabled;i(r)})})},t}();t.OpenTokCapabilitiesProvider=r})(i=t.OpenTok||(t.OpenTok={}))})(t=n.Providers||(n.Providers={}))})(t=n.Conference||(n.Conference={}))})(Oct8ne||(Oct8ne={}));__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})};__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},function(n){var t;(function(t){var i;(function(i){var r;(function(r){var u=function(){function u(t,i,r){var u=this;this.settings=t;this.platform=i;this.sessionStorageManager=r;this.shouldAskDevicePermissionsInIe=!1;this.isEnded=!1;this.onConnected=new n.Event;this.onDisconnected=new n.Event;this.onScreenSharingCapabilitiesDetected=new n.Event;this.onLocalMediaError=new n.Event;this.onLocalScreenSharingStatusChanged=new n.Event;this.onRemoteScreenSharingStatusChanged=new n.Event;this.onLocalMediaAvailabilityChanged=new n.Event;this.onRemoteMediaAvailabilityChanged=new n.Event;this.onRecordingStarted=new n.Event;this.onRecordingStopped=new n.Event;this.onError=new n.Event;this.isRecordingOperationActive=!1;OT.on("exception",function(n){u.logError(n.message)});this.checkScreenSharingExtension()}return u.prototype.toggleCamera=function(){this.currentUserPublisher&&this.currentUserPublisher.cycleVideo()["catch"](console.error)},u.prototype.getProviderCapabilities=function(){var n=new i.ProviderCapabilities;return n.supportsAudio=n.supportsVideo=n.supportsScreenSharing=n.supportsRecording=!0,n},u.prototype.initializeCallAsync=function(n,i,r){return __awaiter(this,void 0,void 0,function(){var f,e,u,o,s;return __generator(this,function(h){switch(h.label){case 0:this.log("Initializing call in provider...");this.isEnded=!1;this.callType=i;h.label=1;case 1:return h.trys.push([1,3,,4]),f=this,[4,this.getOrCreateOpenTokSessionAsync(n)];case 2:return f.openTokSessionInfo=h.sent(),[3,4];case 3:return e=h.sent(),this.logError("Error creating OpenTok session: "+e),[2,new t.ProviderError(t.ProviderErrorType.InitializationError,"Error initializing provider")];case 4:if(u=new t.ProviderInformation("opentok",this.openTokSessionInfo),i==="screen-only-call")return[2,u];h.label=5;case 5:return h.trys.push([5,7,,8]),this.log("Initializing devices"),[4,this.createPublisherAsync(!0,r,!0)];case 6:return o=h.sent(),this.stopPublisher(o),[2,u];case 7:return s=h.sent(),this.log("Error initializing devices, so the call can't be started"),[2,new t.ProviderError(t.ProviderErrorType.MediaDevicesNotAllowed,"Media device error initializing provider")];case 8:return[2]}})})},u.prototype.startAsync=function(n,i,r){return __awaiter(this,void 0,void 0,function(){var e,u,o,f,s;return __generator(this,function(h){switch(h.label){case 0:return this.log("Start, caller: "+n),this.iAmTheCaller=n,this.currentSessionInfo=r.extraData,this.currentSessionId=i.sessionId,[4,this.getOrCreateOpenTokAccessTokenAsync(this.currentSessionId,this.currentSessionInfo.sessionId)];case 1:e=h.sent();this.openTokAccessToken=e;this.localEndpoint=t.EndpointProperties.createEmpty();this.remoteEndpoint=i.properties.remote;h.label=2;case 2:return(h.trys.push([2,11,,12]),u=this.createSession(),!!u.isConnected())?[3,4]:[4,this.connectToSessionAsync(u)];case 3:h.sent();h.label=4;case 4:return(this.currentSession=u,!(i.properties.type==="screen-only-call"))?[3,7]:n?[4,this.startScreenSharingAsync()]:[3,6];case 5:if(h.sent(),!this.localEndpoint.isSharingScreen)return this.end(t.EndCallCause.Cancelled),[2];h.label=6;case 6:return[3,10];case 7:return o=t.EndpointProperties.create(i.properties.local),[4,this.createPublisherAsync(n,o,!0)];case 8:return f=h.sent(),[4,this.startPublishingAsync(u,f)];case 9:h.sent();this.currentUserPublisher=f;h.label=10;case 10:return this.onConnected.trigger(),this.log("Start finished!"),[3,12];case 11:return s=h.sent(),n&&this.onError.trigger(new t.ProviderError(t.ProviderErrorType.InitializationError,s)),[3,12];case 12:return[2]}})})},u.prototype.startVideoAsync=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return this.localEndpoint.isSharingScreen?(this.log("Stopping screen sharing..."),this.wasVideoAvailableBeforeScreenSharing=!0,[4,this.stopScreenSharingAsync()]):[3,2];case 1:return n.sent(),[2];case 2:return this.log("Starting video..."),this.localEndpoint.isVideoAvailable=!0,this.localEndpoint.isSharingScreen=!1,this.currentUserPublisher.publishVideo(!0),this.onLocalMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("video",!0)),[2]}})})},u.prototype.stopVideoAsync=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return this.log("Stopping video..."),this.localEndpoint.isVideoAvailable=!1,this.currentUserPublisher.publishVideo(!1),this.onLocalMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("video",!1)),[2]})})},u.prototype.startScreenSharingAsync=function(){return __awaiter(this,void 0,void 0,function(){var n,i;return __generator(this,function(r){switch(r.label){case 0:this.wasVideoAvailableBeforeScreenSharing=this.localEndpoint.isVideoAvailable;this.wasAudioAvailableBeforeScreenSharing=this.localEndpoint.isAudioAvailable;this.currentScreenPublisher=null;r.label=1;case 1:return r.trys.push([1,4,,5]),[4,this.createPublisherAsync(this.iAmTheCaller,t.EndpointProperties.createScreenSharingProperties(),!1)];case 2:return n=r.sent(),[4,this.startPublishingAsync(this.currentSession,n)];case 3:return r.sent(),this.currentScreenPublisher=n,[3,5];case 4:return i=r.sent(),this.log("Screen sharing cancelled: "+i),this.stopScreenSharingAsync(),[3,5];case 5:return[2]}})})},u.prototype.stopScreenSharingAsync=function(){return __awaiter(this,void 0,void 0,function(){var i,n,r;return __generator(this,function(u){switch(u.label){case 0:this.log("Stopping screen Sharing...");this.currentScreenPublisher&&(this.currentSession.unpublish(this.currentScreenPublisher),this.currentScreenPublisher&&this.currentScreenPublisher.destroy());this.currentSession&&this.currentUserPublisher&&(this.currentSession.unpublish(this.currentUserPublisher),this.currentUserPublisher&&this.currentUserPublisher.destroy());this.localEndpoint.isAudioAvailable||(this.log("Nothing to publish"),this.localEndpoint.isVideoAvailable=!1,this.localEndpoint.isAudioAvailable=!1,this.localEndpoint.isSharingScreen=!1,this.onLocalMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("video",!1)),this.onLocalMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("audio",!1)),this.onLocalScreenSharingStatusChanged.trigger(!1));u.label=1;case 1:return(u.trys.push([1,5,,6]),!(this.callType!=="screen-only-call"))?[3,4]:(i=new t.EndpointProperties(this.wasAudioAvailableBeforeScreenSharing,this.localEndpoint.isAudioMuted,this.wasVideoAvailableBeforeScreenSharing,this.localEndpoint.isVideoMuted,!1),[4,this.createPublisherAsync(this.iAmTheCaller,i,!1)]);case 2:return n=u.sent(),[4,this.startPublishingAsync(this.currentSession,n)];case 3:u.sent();this.currentUserPublisher=n;u.label=4;case 4:return this.onLocalScreenSharingStatusChanged.trigger(!1),[3,6];case 5:return r=u.sent(),this.log("Exception republishing"+r),this.onLocalMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("video",!1)),this.onLocalMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("audio",!1)),this.onLocalScreenSharingStatusChanged.trigger(!1),[3,6];case 6:return[2]}})})},u.prototype.end=function(n){this.iAmTheCaller=!1;this.log("Ending session...");this.currentScreenPublisher&&(this.currentScreenPublisher=null);this.currentUserPublisher&&(this.currentUserPublisher=null);this.currentSession&&(this.log("Finalizing current session..."),this.currentSession.disconnect(),this.currentSession.off(),this.currentSession=null);this.currentSubscriber=null;this.currentStreamId=null;this.currentArchiveId=null;this.currentSessionId=null;this.clearOpenTokCurrentSessionInfo();this.onDisconnected.trigger(n);this.log("Ending session finished");this.isEnded=!0},u.prototype.muteVideo=function(n){this.currentUserPublisher&&(this.log("Mute video set to "+n),this.currentUserPublisher.publishVideo(!n))},u.prototype.muteAudio=function(n){this.currentUserPublisher&&(this.localEndpoint.isAudioMuted=n,this.log("Mute audio set to "+n),this.currentUserPublisher.publishAudio(!n))},u.prototype.startRecordingAsync=function(){return __awaiter(this,void 0,void 0,function(){var n,t;return __generator(this,function(i){switch(i.label){case 0:if(this.isRecordingOperationActive)return[2,!1];this.isRecordingOperationActive=!0;i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,this.platform.startOpentokRecording(this.currentSessionId,this.currentSessionInfo.sessionId)];case 2:return n=i.sent(),this.currentArchiveId=n.id,[2,!0];case 3:return t=i.sent(),this.logError("Error trying to start recording: "+t),[2,!1];case 4:return this.isRecordingOperationActive=!1,[7];case 5:return[2]}})})},u.prototype.stopRecordingAsync=function(){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(t){switch(t.label){case 0:if(this.isRecordingOperationActive)return[2,!1];this.isRecordingOperationActive=!0;t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,this.platform.stopOpentokRecording(this.currentSessionId,this.currentArchiveId)];case 2:return t.sent(),this.currentArchiveId=null,[2,!0];case 3:return n=t.sent(),this.logError("Error trying to stop recording: "+n),[2,!1];case 4:return this.isRecordingOperationActive=!1,[7];case 5:return[2]}})})},u.prototype.installScreenSharingExtension=function(){var n=this;chrome.webstore.install("https://chrome.google.com/webstore/detail/"+this.settings.chromeExtensionId,function(){n.log("Chrome extension installed :)");window.location.reload(!0);n.checkScreenSharingExtension()},function(t){alert("The extension could not be installed. Please go to personal settings and download the extension using a link");n.logError("Error installing Chrome extension: "+t)})},u.prototype.stopPublisher=function(n){n&&(n.off(),this.currentSession&&this.currentSession.unpublish(n),n.destroy())},u.prototype.createSession=function(){var n=this,i;this.log("Setting up session object...");i=OT.initSession(this.currentSessionInfo.apiKey,this.currentSessionInfo.sessionId);i.once("sessionConnected",function(){n.log("Triggered: session.sessionConnected");n.onConnected.trigger()});i.once("sessionDisconnected",function(i){n.log("Triggered: session.sessionDisconnected");var r;switch(i.reason){case"clientDisconnected":r=t.EndCallCause.PeerDisconnected;break;case"networkDisconnected":r=t.EndCallCause.LocalDisconnection;break;default:r=t.EndCallCause.GeneralError}n.log("Session disconnected. Reason: "+i.reason);n.end(r)});i.on("streamCreated",function(r){if(n.log("Triggered: session.streamCreated ("+r.stream.id+", "+r.stream.videoType+")"),r.stream.id===n.currentStreamId){n.log("   *** Ignoring, duplicate stream");r.preventDefault();return}n.currentStreamId=r.stream.id;n.log("Remote stream created: "+r.stream.name+", hasAudio: "+r.stream.hasAudio+", hasVideo: "+r.stream.hasVideo);n.onRemoteMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("video",r.stream.hasVideo));var u=r.stream.hasAudio||r.stream.hasVideo&&n.localEndpoint.isSharingScreen;n.onRemoteMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("audio",u));n.onRemoteScreenSharingStatusChanged.trigger(r.stream.hasVideo&&r.stream.videoType==="screen");n.configureSubscriberForStreamAsync(i,r.stream)});i.on("streamDestroyed",function(i){n.log("Triggered: session.streamDestroyed ("+i.stream.id+")");n.log("Remote stream destroyed: "+i.stream.name+" reason: "+i.reason);i.reason==="networkDisconnected"?n.end(t.EndCallCause.PeerDisconnected):i.stream.hasVideo&&i.stream.videoType==="screen"&&(n.callType==="screen-only-call"?n.end(t.EndCallCause.Ended):n.showMainStream());i.preventDefault()});i.on("streamPropertyChanged",function(i){if(n.log("Triggered: session.streamPropertyChanged ("+i.stream.id+")"),n.currentSession.connection!==i.stream.connection){n.log("**** Remote stream changed: "+i.changedProperty+"=>"+i.newValue);switch(i.changedProperty){case"hasAudio":n.onRemoteMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("audio",i.newValue));break;case"hasVideo":n.onRemoteMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("video",i.newValue))}}});i.on("archiveStarted",function(t){n.log("Started archive with id "+t.id);n.currentArchiveId=t.id;n.onRecordingStarted.trigger()});i.on("archiveStopped",function(t){n.log("Stopped archive with id "+t.id);n.onRecordingStopped.trigger()});return i},u.prototype.configureSubscriberForStreamAsync=function(n,t){var i=this;return new Promise(function(r,u){var l,o,s,e,f,h,c;if(i.log("Configuring subscriber for stream "+t.id+"..."),n==null){i.logError("Can't configure subscriber for a null session");u();return}l={insertMode:"replace",width:"100%",height:"100%",fitMode:"contain",insertDefaultUI:!0,style:{audioLevelDisplayMode:"off",buttonDisplayMode:"off",nameDisplayMode:"off",backgroundImageURI:i.settings.videoUnavailableBackgroundImage}};o=i.getMainStreamWrapperId();document.getElementById(o)||(e=document.getElementById(i.settings.remoteVideoContainer),f=document.createElement("div"),f.id=o,e.appendChild(f));s=i.getSecondaryStreamWrapperId();document.getElementById(s)||(e=document.getElementById(i.settings.remoteVideoContainer),f=document.createElement("div"),f.id=s,e.appendChild(f));t.hasVideo&&t.videoType==="screen"?(h=s,i.showSecondaryStream()):(h=o,i.showMainStream());c=n.subscribe(t,h,l,function(n){n?i.log("Error subscribing stream "+t.name):(i.log("Subscribed to stream "+t.id+", '"+t.name+"'"),r(c))});c.on("videoElementCreated",function(n){i.log("Triggered: subscriber.videoElementCreated");i.log("           Video element for stream "+n.target.stream.id+" created in #"+h)})})},u.prototype.getMainStreamWrapperId=function(){return this.settings.remoteVideoContainer+"-main-wrapper"},u.prototype.getSecondaryStreamWrapperId=function(){return this.settings.remoteVideoContainer+"-secondary-wrapper"},u.prototype.showMainStream=function(){this.log("Showing main stream");document.getElementById(this.getMainStreamWrapperId()).style.display="block";document.getElementById(this.getSecondaryStreamWrapperId()).style.display="none"},u.prototype.showSecondaryStream=function(){this.log("Showing secondary stream");document.getElementById(this.getMainStreamWrapperId()).style.display="none";document.getElementById(this.getSecondaryStreamWrapperId()).style.display="block"},u.prototype.createPublisherAsync=function(n,i,r){var u=this;return new Promise(function(f,e){var h,s,l,c,o;u.log("Initializing publisher with the following properties:");u.log("   -> "+t.EndpointProperties.toString(i));h={name:u.settings.name,audioFallbackEnabled:!0,fitMode:"contain",frameRate:u.settings.frameRate,insertMode:"replace",width:"100%",height:"100%",publishAudio:i.isAudioAvailable||i.isAudioMuted,publishVideo:i.isVideoAvailable,resolution:u.settings.videoWidth+"x"+u.settings.videoHeight,showControls:!0,usePreviousDeviceSelection:!u.shouldAskDevicePermissionsInIe,insertDefaultUI:!0,style:{backgroundImageURI:u.settings.videoUnavailableBackgroundImage,audioLevelDisplayMode:"off",archiveStatusDisplayMode:"auto",nameDisplayMode:"off",buttonDisplayMode:"off"}};u.shouldAskDevicePermissionsInIe=!1;i.isSharingScreen&&(h.videoSource="screen",h.audioSource=null,h.resolution=null);s=u.settings.localVideoContainer+"-wrapper";document.getElementById(s)?u.log("Element "+s+" already exists!"):(u.log("Element "+s+" does not exist, creating..."),l=document.getElementById(u.settings.localVideoContainer),c=document.createElement("div"),c.id=s,l.appendChild(c));o=OT.initPublisher(s,h,function(s){if(u.log("Publisher initialized"),s){if(i.isSharingScreen){u.log("Cancelled!!!");u.onLocalMediaError.trigger("video");e();return}n?(u.log("Publisher initialization error: "+s.message),r&&u.onError.trigger(new t.ProviderError(t.ProviderErrorType.MediaDevicesNotAllowed,s.type)),u.shouldAskDevicePermissionsInIe=!0,e()):(u.shouldAskDevicePermissionsInIe=!0,u.log("Cannot initialize publisher, so I'll be a simple listener"),i.isVideoAvailable?(u.onLocalMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("video",!1)),u.onLocalMediaError.trigger("video")):u.onLocalMediaError.trigger("audio"),f(o));u.onLocalMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("video",!1));u.onLocalMediaError.trigger("video");u.onLocalMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("audio",!1));u.onLocalMediaError.trigger("audio")}else u.log("Publisher initialized successfully"),f(o)});o.on("mediaStopped",function(){u.localEndpoint.isSharingScreen&&u.stopScreenSharingAsync()});o.once("videoElementCreated",function(n){u.log("Triggered: publisher.videoElementCreated");u.log("           Video element created as #"+n.element.id)});o.once("streamCreated",function(n){u.log("Triggered: publisher.streamCreated ("+n.stream.id+")");u.log("    Stream: hasAudio: "+n.stream.hasAudio+", hasVideo: "+n.stream.hasVideo+"("+n.stream.videoType+")");u.log("    Requested properties: "+t.EndpointProperties.toString(i));u.localEndpoint.isVideoAvailable!==n.stream.hasVideo&&(u.localEndpoint.isVideoAvailable=n.stream.hasVideo,u.onLocalMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("video",u.localEndpoint.isVideoAvailable)));n.stream.hasAudio&&(i.isAudioMuted&&o.publishAudio(!1),u.localEndpoint.isAudioAvailable=n.stream.hasAudio,u.onLocalMediaAvailabilityChanged.trigger(new t.MediaAvailabilityChangedEventArgs("audio",u.localEndpoint.isAudioAvailable)));u.localEndpoint.isSharingScreen!==(n.stream.hasVideo&&n.stream.videoType==="screen")&&(u.localEndpoint.isSharingScreen=n.stream.hasVideo&&n.stream.videoType==="screen",u.onLocalScreenSharingStatusChanged.trigger(u.localEndpoint.isSharingScreen));u.log("   -> "+t.EndpointProperties.toString(u.localEndpoint))});o.on("destroyed",function(n){n.target?u.currentUserPublisher&&n.target.streamId===u.currentUserPublisher.streamId?(u.log("Triggered: publisher.destroyed CAMERA"),u.currentUserPublisher.off(),u.currentUserPublisher=null):u.currentScreenPublisher&&n.target.streamId===u.currentScreenPublisher.streamId&&(u.log("Triggered: publisher.destroyed SCREEN"),u.currentScreenPublisher.off(),u.currentScreenPublisher=null):u.log("Triggered: publisher.destroyed STREAM UNKNOWN")});o.on("streamDestroyed",function(n){u.log("Triggered: publisher.streamDestroyed ("+n.stream.id+")")})})},u.prototype.connectToSessionAsync=function(n){var i=this;return new Promise(function(r,u){if(i.log("Connecting to session..."),n==null){i.logError("Can't connect to a null session");u();return}n.connect(i.openTokAccessToken,function(n){n?(i.logError("Connect error: "+n.message),i.onError.trigger(new t.ProviderError(t.ProviderErrorType.OpenTokErrorConnecting,n.message)),u()):(i.log("Connected to the session successfully"),r())})})},u.prototype.startPublishingAsync=function(n,t){var i=this;return new Promise(function(r,u){if(!n){t&&t.destroy();i.logError("Can't start publishing on a null session");u();return}if(!t){i.logError("Can't start publishing a null publisher");u();return}i.log("Start publishing...");n.publish(t,function(n){i.log("Publish ended");n?(i.logError("Publishing error: "+n.message),u()):r()})})},u.prototype.getOrCreateOpenTokSessionAsync=function(n){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(r){switch(r.label){case 0:return(t=null,i=this.sessionStorageManager.get("ot-current-session"),i&&(t=JSON.parse(i)),!(t==null))?[3,2]:(this.log("Creating OpenTok session..."),this.clearOpenTokCurrentSessionInfo(),[4,this.platform.createOpenTokSession(n,this.settings.recordingMode==="always")]);case 1:return t=r.sent(),[3,3];case 2:this.log("Reusing OpenTok session from cache...");r.label=3;case 3:return this.sessionStorageManager.set("ot-current-session",JSON.stringify(t)),[2,t]}})})},u.prototype.getOrCreateOpenTokAccessTokenAsync=function(n,t){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return(i=this.sessionStorageManager.get("ot-current-token"),!!i)?[3,2]:[4,this.platform.getOpenTokAccessToken(n,t)];case 1:i=r.sent();r.label=2;case 2:return this.sessionStorageManager.set("ot-current-token",i),[2,i]}})})},u.prototype.clearOpenTokCurrentSessionInfo=function(){this.sessionStorageManager.remove("ot-current-session");this.sessionStorageManager.remove("ot-current-token")},u.prototype.logError=function(n){this.settings.logging&&console.error("[OpenTok] "+n)},u.prototype.checkScreenSharingExtension=function(){var n=this,t=new r.OpenTokCapabilitiesProvider(this.settings.chromeExtensionId);t.getScreenSharingCapabilitiesAsync().then(function(t){n.onScreenSharingCapabilitiesDetected.trigger(t)})},u.prototype.log=function(n){this.settings.logging&&console.log("[OpenTok] "+n)},u}();r.OpenTokProvider=u})(r=i.OpenTok||(i.OpenTok={}))})(i=t.Providers||(t.Providers={}))})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){this.frameRate=15;this.videoWidth=640;this.videoHeight=480;this.remoteVideoContainer="oct8ne-remote-video";this.localVideoContainer="oct8ne-local-video";this.logging=!1}return n}();n.OpenTokSettings=t})(t=n.OpenTok||(n.OpenTok={}))})(t=n.Providers||(n.Providers={}))})(t=n.Conference||(n.Conference={}))}(Oct8ne||(Oct8ne={}))